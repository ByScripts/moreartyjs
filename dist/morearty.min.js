!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.Morearty=e()}}(function(){var e,t,n;return function r(e,t,n){function i(u,s){if(!t[u]){if(!e[u]){var o=typeof require=="function"&&require;if(!s&&o)return o(u,!0);if(a)return a(u,!0);var f=new Error("Cannot find module '"+u+"'");throw f.code="MODULE_NOT_FOUND",f}var l=t[u]={exports:{}};e[u][0].call(l.exports,function(t){var n=e[u][1][t];return i(n?n:t)},l,l.exports,r,e,t,n)}return t[u].exports}var a=typeof require=="function"&&require;for(var u=0;u<n.length;u++)i(n[u]);return i}({1:[function(e,t,n){(function(n){var r=typeof window!=="undefined"?window.Immutable:typeof n!=="undefined"?n.Immutable:null;var i=e("./Util");var a=e("./util/Holder");var u=e("./ChangesDescriptor");var s={};var o,f,l;o=function(e,t,n,r){return new A(t,n,r,e._options,{regCountHolder:e._regCountHolder,listeners:e._listeners,cache:e._cache})};f=function(e){return e._backingValueHolder.getValue()};l=function(e,t){e._backingValueHolder.setValue(t)};var c,h,d,g,v,p,b;c=[];h=".";d="__meta__";g=function(e){return e?e.split(h).map(function(e){return isNaN(e)?e:+e}):[]};v=function(e,t){return e.length===0?t:t.length===0?e:e.concat(t)};p=function(e,t){return v(e,[d,t])};b=function(e,t){return e&&t.length>0?e.getIn(t):e};var _,m;_=function(e){switch(typeof e){case"string":return g(e);case"number":return[e];default:return i.undefinedOrNull(e)?[]:e}};m=function(e){switch(typeof e){case"string":return e;case"number":return e.toString();default:return i.undefinedOrNull(e)?"":e.join(h)}};var y,w,M,C;y=function(e,t,n){return e.updateIn(t,s,function(e){return e===s?n():n(e)})};w=function(e,t,n){var r=v(e._path,t);var i=y(f(e),r,n);l(e,i);return r};M=function(e,t){var n=v(e._path,t);var i=f(e);var a=n.length;switch(a){case 0:throw new Error("Cannot delete root value");default:var u=n.slice(0,a-1);if(i.has(u[0])||a===1){var s=i.updateIn(u,function(e){var t=n[a-1];if(e instanceof r.List){return e.splice(t,1)}else{return e&&e.delete(t)}});l(e,s)}return u}};C=function(e){return e instanceof r.Iterable?e.clear():null};var E,V,S,P,I,O;E=function(e,t,n,r,a,s){if(a||s){i.getPropertyValues(t).forEach(function(t){if(!t.disabled){t.cb(new u(e,r,_(n),a,s))}})}};V=function(e,t,n,r){var i=e._listeners;var a=i[""];if(a){E(e,a,c,t,n,r)}};S=function(e,t){return e.indexOf(t)===0};P=function(e,t){return S(t,e)||S(e,t)};I=function(e,t,n,r){var a=e._listeners;Object.keys(a).filter(i.identity).forEach(function(i){if(P(i,m(t))){E(e,a[i],i,t,n,r)}})};O=function(e,t,n,r){I(e,t,n,r);V(e,t,n,r)};var R,B;R=function(e,t){return i.find(i.getPropertyValues(e._listeners),function(e){return!!e[t]})};B=function(e,t,n){var r=R(e,t);if(r){r[t].disabled=n}};var A=function(e,t,n,r,i){this._backingValueHolder=e;this._metaBinding=t;this._path=n||c;this._options=r||{};var u=i||{};this._regCountHolder=u.regCountHolder||a.init(0);this._listeners=u.listeners||{};this._cache=u.cache||{}};A.init=function(e,t,n){var r=i.resolveArgs(arguments,"backingValue",function(e){return e instanceof A?"metaBinding":null},"?options");var u=new A(e instanceof a?e:a.init(e),r.metaBinding,c,r.options);if(r.metaBinding){r.metaBinding.addGlobalListener(function(e){if(e.isValueChanged()){var t=e.getPath();var n=t.slice(0,t.length-1);O(u,n,null,e.getPreviousValue())}})}return u};A.asArrayPath=function(e){return _(e)};A.asStringPath=function(e){return m(e)};A.META_NODE=d;A.prototype=Object.freeze({getPath:function(){return this._path},withBackingValue:function(e){var t=i.undefinedOrNull(e)?this._backingValueHolder:a.init(e);return o(this,t,this._metaBinding,this._path)},isChanged:function(e,t){var n=this.get();var r=e.getIn(this._path);return t?t(n,r):n!==r},isRelative:function(e){return this._backingValueHolder===e._backingValueHolder},meta:function(){if(!this._metaBinding&&this._options.autoMeta!==false){this._metaBinding=A.init(r.Map())}return this._metaBinding&&this._metaBinding.sub(d)},get:function(e){return b(f(this),v(this._path,_(e)))},toJS:function(e){var t=this.sub(e).get();return t instanceof r.Iterable?t.toJS():t},sub:function(e){var t=_(e);var n=v(this._path,t);if(n.length>0){var r=m(n);var i=this._cache[r];if(i){return i}else{var a=this._metaBinding&&this._metaBinding.sub(t);var u=o(this,this._backingValueHolder,a,n);this._cache[r]=u;return u}}else{return this}},update:function(e,t){var n=i.resolveArgs(arguments,"?subpath","f");var r=f(this);var a=w(this,_(n.subpath),n.f);O(this,a,r,null);return this},set:function(e,t){var n=i.resolveArgs(arguments,"?subpath","newValue");return this.update(n.subpath,i.constantly(n.newValue))},"delete":function(e){var t=f(this);var n=M(this,_(e));O(this,n,t,null);return this},merge:function(e,t,n){var a=i.resolveArgs(arguments,function(e){return i.canRepresentSubpath(e)?"subpath":null},"?preserve","newValue");return this.update(a.subpath,function(e){var t=a.newValue;if(i.undefinedOrNull(e)){return t}else{if(e instanceof r.Iterable&&t instanceof r.Iterable){return a.preserve?t.mergeDeep(e):e.mergeDeep(t)}else{return a.preserve?e:t}}})},clear:function(e){var t=_(e);if(!i.undefinedOrNull(this.get(t)))this.update(t,C);return this},addListener:function(e,t){var n=i.resolveArgs(arguments,function(e){return i.canRepresentSubpath(e)?"subpath":null},"cb");var r="reg"+this._regCountHolder.updateValue(function(e){return e+1});var a=m(v(this._path,_(n.subpath||"")));var u=this._listeners[a];var s={cb:n.cb,disabled:false};if(u){u[r]=s}else{var o={};o[r]=s;this._listeners[a]=o}return r},addGlobalListener:function(e){return this.addListener(c,e)},enableListener:function(e){B(this,e,false);return this},disableListener:function(e){B(this,e,true);return this},withDisabledListener:function(e,t){var n=R(this,e);if(n){var r=n[e];r.disabled=true;i.afterComplete(t,function(){r.disabled=false})}else{t()}return this},removeListener:function(e){var t=R(this,e);return t?delete t[e]:false},atomically:function(){return new x(this)}});var x=function(e,t,n){this._binding=e;this._updates=t||[];this._deletions=n||[];this._committed=false;this._hasChanges=false;this._hasMetaChanges=false};x.prototype=function(){var e,t;e=function(e,t){if(!e._hasChanges){e._hasChanges=t.isRelative(e._binding)}if(!e._hasMetaChanges){var n=e._binding.meta();if(n){e._hasMetaChanges=t.isRelative(n)}}};t=function(e){return e._hasChanges||e._hasMetaChanges};var n,a,u,s,o;n=function(t,n,r,i){e(t,n);t._updates.push({binding:n,update:r,subpath:i})};a=function(t,n,r){e(t,n);t._deletions.push({binding:n,subpath:r})};u=function(e,t){var n=e.length,r=t.length;return n===r&&(n===1||e[n-2]===t[n-2])};s=function(e){if(e.length<2){return e}else{var t=e.sort();var n=t[0],r=m(n);var i=[n];for(var a=1;a<t.length;a++){var s=t[a],o=m(s);if(!S(o,r)){if(u(s,n)){var f=s.slice(0,s.length-1);i.pop();i.push(f);n=f;r=m(f)}else{i.push(s);n=s;r=o}}}return i}};o=function(e){if(!e._committed){var t=e._updates.map(function(e){return w(e.binding,e.subpath,e.update)});var n=e._deletions.map(function(e){return M(e.binding,e.subpath)});e._committed=true;return v(t,n)}else{throw new Error("Transaction already committed")}};return Object.freeze({update:function(e,t,r){var a=i.resolveArgs(arguments,function(e){return e instanceof A?"binding":null},"?subpath","f");n(this,a.binding||this._binding,a.f,_(a.subpath));return this},set:function(e,t,n){var r=i.resolveArgs(arguments,function(e){return e instanceof A?"binding":null},"?subpath","newValue");return this.update(r.binding,r.subpath,i.constantly(r.newValue))},"delete":function(e,t){var n=i.resolveArgs(arguments,function(e){return e instanceof A?"binding":null},"?subpath");a(this,n.binding||this._binding,_(n.subpath));return this},merge:function(e,t,n,a){var u=i.resolveArgs(arguments,function(e){return e instanceof A?"binding":null},function(e){return i.canRepresentSubpath(e)?"subpath":null},function(e){return typeof e==="boolean"?"preserve":null},"newValue");return this.update(u.binding,u.subpath,function(e){var t=u.newValue;if(i.undefinedOrNull(e)){return t}else{if(e instanceof r.Iterable&&t instanceof r.Iterable){return u.preserve?t.mergeDeep(e):e.mergeDeep(t)}else{return u.preserve?e:t}}})},clear:function(e,t){var r=i.resolveArgs(arguments,function(e){return e instanceof A?"binding":null},"?subpath");n(this,r.binding||this._binding,function(e){return C(e)},_(r.subpath));return this},commit:function(e){if(t(this)){var n=e||{};var r=this._binding;var i=null,a=null;if(n.notify!==false){if(this._hasChanges)i=f(r);if(this._hasMetaChanges)a=f(r.meta())}var u=o(this);if(n.notify!==false){var l=s(u);l.forEach(function(e){I(r,e,i,a)});V(r,l[0],i,a)}return u}else{return[]}}})}();t.exports=A}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./ChangesDescriptor":2,"./Util":6,"./util/Holder":8}],2:[function(e,t,n){var r=function(e,t,n,r,i){this._binding=e;this._path=t;this._listenerPath=n;this._previousValue=r;this._previousMeta=i};r.prototype=Object.freeze({getPath:function(){var e=this._listenerPath.length;return e===this._path.length?[]:this._path.slice(e)},isValueChanged:function(){return!!this._previousValue&&this._binding.get(this._listenerPath)!==this._previousValue.getIn(this._listenerPath)},isMetaChanged:function(){return!!this._previousMeta},getPreviousValue:function(){return this._previousValue&&this._previousValue.getIn(this._listenerPath)},getPreviousMeta:function(){return this._previousMeta&&this._previousMeta.getIn(this._listenerPath)}});t.exports=r},{}],3:[function(e,t,n){(function(n){var r=e("./Util");var i=typeof window!=="undefined"?window.React:typeof n!=="undefined"?n.React:null;var a=function(){if(i)return i.DOM;else{throw new Error("Morearty: global variable React not found")}}();var u=function(e,t){return i.createClass({displayName:t,getInitialState:function(){return{value:this.props.value}},onChange:function(e){var t=this.props.onChange;if(t){t(e);this.setState({value:e.target.value})}},componentWillReceiveProps:function(e){this.setState({value:e.value})},render:function(){var t=r.assign({},this.props,{value:this.state.value,onChange:this.onChange,children:this.props.children});return e(t)}})};var s={input:u(a.input,"input"),textarea:u(a.textarea,"textarea"),option:u(a.option,"option")};t.exports=s}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./Util":6}],4:[function(e,t,n){(function(n){var r=typeof window!=="undefined"?window.Immutable:typeof n!=="undefined"?n.Immutable:null;var i=e("./Binding");var a,u,s,o,f,l,c;a=function(e){return e.meta().sub("history")};u=function(e){e.set(r.fromJS({listenerId:null,undo:[],redo:[]}))};s=function(e){var t=e.get("listenerId");e.withDisabledListener(t,function(){e.atomically().set("undo",r.List.of()).set("redo",r.List.of()).commit()})};o=function(e,t){var n=a(e);var r=n.get("listenerId");e.removeListener(r);n.atomically().set(null).commit({notify:t})};f=function(e,t){var n=e.addListener([],function(n){t.atomically().update(function(t){var a=n.getPath();var u=n.getPreviousValue(),s=e.get();return t.update("undo",function(e){var t=i.asArrayPath(a);return e&&e.unshift(r.Map({newValue:t.length?s.getIn(t):s,oldValue:t.length?u.getIn(t):u,path:a}))}).set("redo",r.List.of())}).commit({notify:false})});t.atomically().set("listenerId",n).commit({notify:false})};l=function(e,t,n,r){r.withDisabledListener(n,function(){r.set(e,t)})};c=function(e,t,n,r,i){var a=t.get();if(a.count()>0){var u=a.get(0);t.atomically().delete(0).update(n,function(e){return e.unshift(u)}).commit({notify:false});l(u.get("path"),u.get(i),r,e);return true}else{return false}};var h={init:function(e){var t=a(e);u(t);f(e,t)},clear:function(e){var t=a(e);s(t)},destroy:function(e,t){var n=t||{};o(e,n.notify)},hasUndo:function(e){var t=a(e);var n=t.get("undo");return!!n&&n.count()>0},hasRedo:function(e){var t=a(e);var n=t.get("redo");return!!n&&n.count()>0},undo:function(e){var t=a(e);var n=t.get("listenerId");var r=t.sub("undo");var i=t.sub("redo");return c(e,r,i,n,"oldValue")},redo:function(e){var t=a(e);var n=t.get("listenerId");var r=t.sub("undo");var i=t.sub("redo");return c(e,i,r,n,"newValue")}};t.exports=h}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./Binding":1}],5:[function(e,t,n){(function(n){var r=typeof window!=="undefined"?window.Immutable:typeof n!=="undefined"?n.Immutable:null;var i=e("./Util");var a=e("./Binding");var u=e("./History");var s=e("./util/Callback");var o=e("./DOM");var f=Object.freeze({OVERWRITE:"overwrite",OVERWRITE_EMPTY:"overwrite-empty",MERGE_PRESERVE:"merge-preserve",MERGE_REPLACE:"merge-replace"});var l,c,h;l=function(e,t,n){if(e){var r=t.props[e._configuration.bindingPropertyName];return n?r[n]:r}else{throw new Error("Context is missing.")}};c=function(e,t){return t._stateChanged&&e.isChanged(t._previousState)||t._metaChanged&&t._metaBinding.sub(e.getPath()).isChanged(t._previousMetaState)};h=function(e,t){if(t instanceof a){return c(t,e)}else{var n=i.getPropertyValues(t);return!!i.find(n,function(t){return t&&c(t,e)})}};var d=function(e,t,n){var a=n.atomically();if(typeof e==="function"){a=a.update(function(n){return e(n,t)})}else{switch(e){case f.OVERWRITE:a=a.set(t);break;case f.OVERWRITE_EMPTY:a=a.update(function(e){var n=i.undefinedOrNull(e)||e instanceof r.Iterable&&e.count()===0;return n?t:e});break;case f.MERGE_PRESERVE:a=a.merge(true,t);break;case f.MERGE_REPLACE:a=a.merge(false,t);break;default:throw new Error("Invalid merge strategy: "+e)}}a.commit({notify:false})};var g=function(e,t,n){this._initialMetaState=t;this._previousMetaState=null;this._metaBinding=a.init(t);this._metaChanged=false;this._initialState=e;this._previousState=null;this._stateBinding=a.init(e,this._metaBinding);this._stateChanged=false;this._configuration=n;this._fullUpdateQueued=false;this._fullUpdateInProgress=false};g.prototype=Object.freeze({getBinding:function(){return this._stateBinding},getMetaBinding:function(){return this._metaBinding},getCurrentState:function(){return this.getBinding().get()},getPreviousState:function(){return this._previousState},getCurrentMeta:function(){var e=this.getMetaBinding();return e?e.get():undefined},getPreviousMeta:function(){return this._previousMetaState},resetState:function(e,t){var n=i.resolveArgs(arguments,function(e){return i.canRepresentSubpath(e)?"subpath":null},"?options");var r=n.subpath?a.asArrayPath(n.subpath):[];var u=this.getBinding().atomically();u.set(r,this._initialState.getIn(r));var s=n.options||{};if(s.resetMeta!==false){u.set(this.getMetaBinding(),r,this._initialMetaState.getIn(r))}u.commit({notify:s.notify})},replaceState:function(e,t,n){var a=i.resolveArgs(arguments,"newState",function(e){return e instanceof r.Map?"newMetaState":null},"?options");var u=a.options||{};var s=this.getBinding().atomically();s.set(e);if(a.newMetaState)s.set(this.getMetaBinding(),a.newMetaState);s.commit({notify:u.notify})},isChanged:function(e,t,n){var a=i.resolveArgs(arguments,"binding",function(e){return i.canRepresentSubpath(e)?"subpath":null},"?compare");return!a.binding.sub(a.subpath).isChanged(this._previousState,a.compare||r.is)},init:function(e){var t=this;var n=t._configuration.requestAnimationFrameEnabled;var r=window&&window.requestAnimationFrame;var i=function(n,r,i){if(e.isMounted()){t._stateChanged=r;if(r){t._currentState=t._stateBinding.get();t._previousState=n.getPreviousValue()}t._metaChanged=i;if(i){t._currentMetaState=t._metaBinding.get();t._previousMetaState=n.getPreviousMeta()}try{if(t._fullUpdateQueued){t._fullUpdateInProgress=true;e.forceUpdate(function(){t._fullUpdateQueued=false;t._fullUpdateInProgress=false})}else{e.forceUpdate()}}catch(a){if(t._configuration.stopOnRenderError){throw a}else{console.error("Morearty: skipping render error",a)}}}};t._stateBinding.addGlobalListener(function(e){var t=e.isValueChanged(),a=e.isMetaChanged();if(t||a){if(n&&r){r(i.bind(null,e,t,a),null)}else{i(e,t,a)}}})},queueFullUpdate:function(){this._fullUpdateQueued=true}});t.exports={Binding:a,History:u,Util:i,Callback:s,DOM:o,MergeStrategy:f,Mixin:{contextTypes:{morearty:function(){}},getMoreartyContext:function(){return this.context.morearty},getBinding:function(e){return l(this.getMoreartyContext(),this,e)},getDefaultBinding:function(){var e=this.getMoreartyContext();var t=l(e,this);if(t instanceof a){return t}else if(typeof t==="object"){var n=Object.keys(t);return n.length===1?t[n[0]]:t["default"]}},getPreviousState:function(e){var t=this.getMoreartyContext();return l(t,this,e).withBackingValue(t._previousState).get()},componentWillMount:function(){if(typeof this.getDefaultState==="function"){var e=this.getMoreartyContext();var t=this.getDefaultState();if(t){var n=l(e,this);var i=typeof this.getMergeStrategy==="function"?this.getMergeStrategy():f.MERGE_PRESERVE;var u=t instanceof r.Iterable;if(n instanceof a){var s=u?t:t["default"];d.call(e,i,s,n)}else{var o=Object.keys(n);var c=o.length===1?o[0]:"default";var h=typeof i==="string"?i:i[c];if(u){d.call(e,h,t,n[c])}else{o.forEach(function(r){if(t[r]){d.call(e,h,t[r],n[r])}})}}}}},shouldComponentUpdate:function(e,t){var n=this;var r=n.getMoreartyContext();var i=function(){if(r._fullUpdateInProgress){return true}else{var e=l(r,n);return!e||h(r,e)}};var a=n.shouldComponentUpdateOverride;return a?a(i,e,t):i()}},createContext:function(e,t,n){var i=function(e){return e instanceof r.Iterable?e:r.fromJS(e)};var a=i(e);var u=t?i(t):r.Map();var s=n||{};return new g(a,u,{bindingPropertyName:s.bindingPropertyName||"binding",requestAnimationFrameEnabled:s.requestAnimationFrameEnabled||false,stopOnRenderError:s.stopOnRenderError||false})}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./Binding":1,"./DOM":3,"./History":4,"./Util":6,"./util/Callback":7}],6:[function(e,t,n){var r,i,a;r=function(e){return typeof e==="string"&&e.charAt(0)!=="?"};i=function(e,t){var n=t(e[0]);for(var r=1;r<e.length;r++){if(t(e[r])!==n)return r}return null};a=function(e,t){return e.slice(t).reverse().concat(e.slice(0,t))};t.exports={identity:function(e){return e},not:function(e){return!e},constantly:function(e){return function(){return e}},async:function(e){setTimeout(e,0)},afterComplete:function(e,t){var n=e();if(n&&typeof n.always==="function"){n.always(t)}else{t()}},undefinedOrNull:function(e){return e===undefined||e===null},getPropertyValues:function(e){return Object.keys(e).map(function(t){return e[t]})},find:function(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(t(r,n,e)){return r}}return null},resolveArgs:function(e,t){var n={};if(arguments.length>1){var u=Array.isArray(t)?t:Array.prototype.slice.call(arguments,1);var s,o;var f;if(r(u[0])||!(f=i(u,r))){s=u;o=e}else{var l=Array.isArray(e)?e:Array.prototype.slice.call(e);s=a(u,f);o=a(l,l.length-(u.length-f))}for(var c=0,h=0;c<s.length&&h<o.length;c++){var d=s[c],g=o[h];if(r(d)){n[d]=g;h++}else{var v=typeof d==="function"?d(g):d.charAt(0)!=="?"?d:d.substring(1);if(v||g===undefined){n[v]=g;h++}}}}return n},canRepresentSubpath:function(e){var t=typeof e;return t==="string"||t==="number"||Array.isArray(e)},assign:function(e,t){if(e===undefined||e===null){throw new TypeError("Cannot convert first argument to object")}var n=Object(e);var r=false;var i;for(var a=1;a<arguments.length;a++){var u=arguments[a];if(u===undefined||u===null)continue;var s=Object.keys(Object(u));for(var o=0,f=s.length;o<f;o++){var l=s[o];try{var c=Object.getOwnPropertyDescriptor(u,l);if(c!==undefined&&c.enumerable)n[l]=u[l]}catch(h){if(!r){r=true;i=h}}}if(r)throw i}return n}}},{}],7:[function(e,t,n){var r=e("../Util");t.exports={set:function(e,t,n){var i=r.resolveArgs(arguments,"binding",function(e){return r.canRepresentSubpath(e)?"subpath":null},"?f");return function(t){var n=t.target.value;e.set(i.subpath,i.f?i.f(n):n)}},"delete":function(e,t,n){var i=r.resolveArgs(arguments,"binding",function(e){return r.canRepresentSubpath(e)?"subpath":null},"?pred");return function(t){var n=t.target.value;if(!i.pred||i.pred(n)){e.delete(i.subpath)}}},onKey:function(e,t,n,i){var a=n||false;var u=i||false;return function(n){var i=typeof t==="string"?n.key===t:r.find(t,function(e){return e===n.key});if(i&&n.shiftKey===a&&n.ctrlKey===u){e(n)}}},onEnter:function(e){return this.onKey(e,"Enter")},onEscape:function(e){return this.onKey(e,"Escape")}}},{"../Util":6}],8:[function(e,t,n){var r=function(e){this._value=e};r.init=function(e){return new r(e)};r.prototype=Object.freeze({getValue:function(){return this._value},setValue:function(e){this._value=e},updateValue:function(e){var t=this._value;this._value=e(t);return t}});t.exports=r},{}]},{},[5])(5)});