!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.Morearty=e()}}(function(){var e,t,n;return function r(e,t,n){function i(a,s){if(!t[a]){if(!e[a]){var o=typeof require=="function"&&require;if(!s&&o)return o(a,!0);if(u)return u(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var f=t[a]={exports:{}};e[a][0].call(f.exports,function(t){var n=e[a][1][t];return i(n?n:t)},f,f.exports,r,e,t,n)}return t[a].exports}var u=typeof require=="function"&&require;for(var a=0;a<n.length;a++)i(n[a]);return i}({1:[function(e,t,n){t.exports=function(t){var n=e("./Util");var r=e("./util/Holder");var i,u,a;i=function(e,t,n){return new k(t,e._regCountHolder,n,e._listeners,e._listenerNestingLevelHolder)};u=function(e){return e._backingValueHolder.getValue()};a=function(e,t){e._backingValueHolder.setValue(t)};var s,o,l,f,c,p;s=[];o=".";l=function(e){return e?e.split(o).map(function(e){return isNaN(e)?e:+e}):[]};f=function(e){return typeof e==="string"?l(e):n.undefinedOrNull(e)?[]:e};c=function(e){return typeof e==="string"?e:e.join(o)};p=function(e,t){return e.concat(t)};var v,h,d,g,b,m;v=function(){throw new Error("Path must point to a key")};h=function(e,t){return t.length>0?e.getIn(t):e};d=function(e,t,n){var r=p(e._path,n);var i=t(u(e),r);a(e,i);return r};g=function(e,n,r){return d(e,function(e,r){var i=function(e,r){if(e){return e.has(r)?e.update(r,n):e.set(r,n())}else{return t.Map.empty().set(r,n())}};var u=r.length;switch(u){case 0:v();break;case 1:return i(e,r[0]);default:var a=r.slice(0,u-1);var s=r[u-1];return e.updateIn(a,function(e){return i(e,s)})}},r)};b=function(e,n){var r=p(e._path,n);var i=u(e);var s;var o=r.length;var l=r.slice(0,o-1);var f=function(e,n){if(e instanceof t.Vector){return e.splice(n,1).toVector()}else{return e.delete(n)}};switch(o){case 0:v();break;case 1:s=f(i,r[0]);break;default:var c=r[o-1];s=i.has(l[0])&&i.updateIn(l,function(e){return f(e,c)})||i}a(e,s);return l};m=function(e){return e?e.clear():e};var _,y,w,S,V,E,R;_=function(e,t){e._listenerNestingLevelHolder.updateValue(function(e){return e+1});t(e._listenerNestingLevelHolder.getValue());e._listenerNestingLevelHolder.updateValue(function(e){return e-1})};y=function(e,t){if(e.length===t.length){return""}else{return c(t.slice(e.length))}};w=function(e,t,r,i,u){var a=f(t);var s=f(r);var o=h(i,a);var l=h(u,a);if(o!==l){n.getPropertyValues(e).forEach(function(e){if(!e.disabled){e.cb(o,l,r,y(a,s))}})}};S=function(e,t,n,r,i){if(i<2){var u=e[""];if(u){w(u,s,c(t),n,r)}}};V=function(e,t){return n.startsWith(t,e)||n.startsWith(e,t)};E=function(e,t,r,i){var u=c(t);Object.keys(e).filter(n.identity).forEach(function(t){if(V(t,u)){w(e[t],t,u,r,i)}})};R=function(e,t,n){_(e,function(r){var i=u(e);E(e._listeners,t,i,n);S(e._listeners,t,i,n,r)})};var A,M;A=function(e,t){return n.find(n.getPropertyValues(e._listeners),function(e){return!!e[t]})};M=function(e,t,n){var r=A(e,t);if(r){r[t].disabled=n}};var k=function(e,t,n,i,u){this._backingValueHolder=e;this._regCountHolder=t||r.init(0);this._path=n||s;this._listeners=i||{};this._listenerNestingLevelHolder=u||r.init(0)};k.prototype=Object.freeze({init:function(e){return new k(r.init(e))},withBackingValue:function(e){return i(this,r.init(e),this._path)},setBackingValue:function(e,t){var n=u(this);this._backingValueHolder.setValue(e);if(t!==false){R(this,s,n)}},val:function(e){return h(u(this),p(this._path,f(e)))},sub:function(e){return i(this,this._backingValueHolder,p(this._path,f(e)))},update:function(e,t){var r=n.resolveArgs(arguments,"?subpath","update");var i=u(this);var a=g(this,r.update,f(r.subpath));R(this,a,i)},set:function(e,t){var r=n.resolveArgs(arguments,"?subpath","newValue");this.update(r.subpath,n.constantly(r.newValue))},"delete":function(e){var t=u(this);var n=b(this,f(e));R(this,n,t)},merge:function(e,r,i){var u=n.resolveArgs(arguments,function(e){return n.canRepresentSubpath(e)?"subpath":null},"?preserve","newValue");this.update(u.subpath,function(e){var r=u.newValue;if(n.undefinedOrNull(e)){return r}else{if(e instanceof t.Sequence&&r instanceof t.Sequence){return u.preserve?r.mergeDeep(e):e.mergeDeep(r)}else{return u.preserve?e:r}}})},clear:function(e){var t=f(e);if(u(this).getIn(t))this.update(t,function(e){return m(e)})},addListener:function(e,t){var n="reg"+this._regCountHolder.updateValue(function(e){return e+1});var r=c(p(this._path,f(e)));var i=this._listeners[r];var u={cb:t,disabled:false};if(i){i[n]=u}else{var a={};a[n]=u;this._listeners[r]=a}return n},addGlobalListener:function(e){return this.addListener(s,e)},enableListener:function(e){M(this,e,false)},disableListener:function(e){M(this,e,true)},withDisabledListener:function(e,t){var r=A(this,e);if(r){var i=r[e];i.disabled=true;n.afterComplete(t,function(){i.disabled=false})}else{t()}},removeListener:function(e){var t=A(this,e);return t?delete t[e]:false},atomically:function(){return new I(this,[],[])},asArrayPath:function(e){return f(e)},asStringPath:function(e){return c(e)},isInstance:function(e){return e instanceof k}});var I=function(e,t,n){this._binding=e;this._updates=t;this._removals=n;this._committed=false};I.prototype=function(){var e,r,i,a,s;e=function(e,t,n,r){var i=e._updates.slice(0);i.push({binding:t,update:n,subpath:r});return i};r=function(e,t,n){var r=e._removals.slice(0);r.push({binding:t,subpath:n});return r};i=function(e){return e._updates.length>0||e._removals.length>0};a=function(e){if(e.length<2){return e}else{var t=e.sort();var r=t[0],i=c(r);var u=[r];for(var a=1;a<t.length;a++){var s=t[a],o=c(s);if(!n.startsWith(o,i)){u.push(s);i=o}}return u}};s=function(e){if(!e._committed){var t=e._updates.map(function(e){return g(e.binding,e.update,e.subpath)});var n=e._removals.map(function(e){return b(e.binding,e.subpath)});e._committed=true;return t.concat(n)}else{throw new Error("Transaction already committed")}};return Object.freeze({update:function(t,r,i){var u=n.resolveArgs(arguments,function(e){return n.canRepresentSubpath(e)?"subpath":null},"?binding","update");var a=u.binding||this._binding;var s=e(this,a,u.update,f(u.subpath));return new I(a,s,this._removals)},set:function(e,t,r){var i=n.resolveArgs(arguments,function(e){return n.canRepresentSubpath(e)?"subpath":null},"?binding","newValue");return this.update(i.subpath,i.binding,n.constantly(i.newValue))},"delete":function(e,t){var i=n.resolveArgs(arguments,function(e){return n.canRepresentSubpath(e)?"subpath":null},"?binding");var u=i.binding||this._binding;var a=r(this,u,f(i.subpath));return new I(u,this._updates,a)},merge:function(e,r,i,u){var a=n.resolveArgs(arguments,function(e){return n.canRepresentSubpath(e)?"subpath":null},function(e){return typeof e==="boolean"?"preserve":null},"?binding","newValue");return this.update(a.subpath,a.binding,function(e){var r=a.newValue;if(n.undefinedOrNull(e)){return u}else{if(e instanceof t.Sequence&&r instanceof t.Sequence){return a.preserve?r.mergeDeep(e):e.mergeDeep(r)}else{return a.preserve?e:r}}})},clear:function(t,r){var i=n.resolveArgs(arguments,function(e){return n.canRepresentSubpath(e)?"subpath":null},"?binding");var u=i.binding||this._binding;var a=e(this,u,function(e){return m(e)},f(i.subpath));return new I(u,a,this._removals)},commit:function(e){if(i(this)){var t=this._binding;var n=u(t);var r=s(this);var o=u(t);if(e!==false){if(o!==n){var l=a(r);_(t,function(e){var r=t._listeners;l.forEach(function(e){E(r,e,o,n)});S(r,l[0],o,n,e)}.bind(t));return r}else{return[]}}else{return r}}else{return[]}}})}();return new k(r.init(null))}},{"./Util":5,"./util/Holder":7}],2:[function(e,t,n){t.exports=function(e){var t=e.DOM;var n=function(t,n){return e.createClass({getDisplayName:function(){return n},getInitialState:function(){return{value:this.props.value}},onChange:function(e){var t=this.props.onChange;if(t){var n=t(e);this.setState({value:e.target.value});return n}},componentWillReceiveProps:function(e){this.setState({value:e.value})},render:function(){return this.transferPropsTo(t({value:this.state.value,onChange:this.onChange,children:this.props.children}))}})};return{input:n(t.input,"input"),textarea:n(t.textarea,"textarea"),option:n(t.option,"option")}}},{}],3:[function(e,t,n){t.exports=function(e){var t,n,r,i,u,a;t=function(t){t.set(e.fromJS({listenerId:null,undo:[],redo:[]}))};n=function(t){t.atomically().set("undo",e.Vector.empty()).set("redo",e.Vector.empty()).commit()};r=function(e){var t=e.val("listenerId");e.removeListener(t);e.set(null)};i=function(t,n){var r=t.addListener([],function(r,i,u,a){n.atomically().update(function(n){return n.update("undo",function(n){var u=t.asArrayPath(a);return n.unshift(e.Map({newValue:u.length?r.getIn(u):r,oldValue:u.length?i.getIn(u):i,path:a}))}).set("redo",e.Vector.empty())}).commit(false)});n.atomically().set("listenerId",r).commit(false)};u=function(e,t,n,r){r.withDisabledListener(n,function(){r.set(e,t)})};a=function(e,t,n,r,i){var a=t.val();if(a.length>0){var s=a.get(0);t.atomically().delete(0).update(n,function(e){return e.unshift(s)}).commit(false);u(s.get("path"),s.get(i),r,e);return true}else{return false}};return{init:function(e,n){t(n);i(e,n)},clear:function(e){n(e)},destroy:function(e){r(e)},hasUndo:function(e){var t=e.val("undo");return!!t&&t.length>0},hasRedo:function(e){var t=e.val("redo");return!!t&&t.length>0},undo:function(e,t){var n=t.val("listenerId");var r=t.sub("undo");var i=t.sub("redo");return a(e,r,i,n,"oldValue")},redo:function(e,t){var n=t.val("listenerId");var r=t.sub("undo");var i=t.sub("redo");return a(e,i,r,n,"newValue")}}}},{}],4:[function(e,t,n){var r=e("./Util");var i=e("./Binding");var u=e("./History");var a=e("./util/Callback");var s=e("./DOM");var o=Object.freeze({OVERWRITE:"overwrite",OVERWRITE_EMPTY:"overwrite-empty",MERGE_PRESERVE:"merge-preserve",MERGE_REPLACE:"merge-replace"});var l=function(e,t,n,r){this.React=e;this.Immutable=t;this.Imm=t;this.DOM=s(e);this.Binding=i(t);this.History=u(t);this._initialState=n;this._previousState=null;this._currentStateBinding=this.Binding.init(n);this._configuration=r;this._fullUpdateQueued=false;this._fullUpdateInProgress=false};l.prototype=function(){var e,t,n;e=function(e,t,n){var r=t.props[e._configuration.statePropertyName];return n?r[n]:r};t=function(e,t){var n=e.val();var r=t?e.withBackingValue(t).val():null;return n!==r};n=function(e,n){var i=e._previousState;if(e.Binding.isInstance(n)){return t(n,i)}else{var u=r.getPropertyValues(n);return!!r.find(u,function(e){return t(e,i)})}};var i,u;i=function(t,r){var i=function(){if(t._fullUpdateInProgress){return true}else{var r=e(t,this);return!r||n(t,r)}};if(!r.shouldComponentUpdate){r.shouldComponentUpdate=i}r.shouldComponentUpdateSuper=i};u=function(t,n){var i=n.componentWillMount;if(typeof n.getDefaultState==="function"){n.componentWillMount=function(){var u=n.getDefaultState();if(u){var a=e(t,this);var s=typeof n.getMergeStrategy==="function"?n.getMergeStrategy():o.MERGE_PRESERVE;var l=a.atomically();if(typeof s==="function"){l=l.update(function(e){return s(e,u)})}else{switch(s){case o.OVERWRITE:l=l.set(u);break;case o.OVERWRITE_EMPTY:l=l.update(function(e){var n=r.undefinedOrNull(e)||e instanceof t.Imm.Sequence&&e.count()===0;return n?u:e});break;case o.MERGE_PRESERVE:l=l.merge(true,u);break;case o.MERGE_REPLACE:l=l.merge(false,u);break;default:throw new Error("Invalid merge strategy: "+s)}}l.commit(false)}if(i){i.call(this)}}}};return Object.freeze({Util:r,Callback:a,MergeStrategy:o,state:function(){return this._currentStateBinding},currentState:function(){return this.state().val()},previousState:function(){return this._previousState},resetState:function(e){this._currentStateBinding.setBackingValue(this._initialState,e!==false)},replaceState:function(e,t){this._currentStateBinding.setBackingValue(e,t)},changed:function(e,t,n){var i=r.resolveArgs(arguments,"binding",function(e){return r.canRepresentSubpath(e)?"subpath":null},"?compare");var u=i.binding.val(i.subpath);var a=i.binding.withBackingValue(this._previousState).val(i.subpath);return i.compare?!i.compare(u,a):u!==a},init:function(e){var t=this;var n=t._configuration.requestAnimationFrameEnabled;var r=window&&window.requestAnimationFrame;var i=function(n,r){t._previousState=r;if(t._fullUpdateQueued){t._fullUpdateInProgress=true;e.forceUpdate(function(){t._fullUpdateQueued=false;t._fullUpdateInProgress=false})}else{e.forceUpdate()}};t._currentStateBinding.addGlobalListener(function(e,u){if(n&&r){r(i.bind(t,e,u),null)}else{i(e,u)}})},createClass:function(t){var n=this;i.call(this,n,t);u.call(this,n,t);t.getState=function(t){return e(n,this,t)};t.getPreviousState=function(t){return e(n,this,t).withBackingValue(n._previousState).val()};return n.React.createClass(t)},queueFullUpdate:function(){this._fullUpdateQueued=true}})}();t.exports={createContext:function(e,t,n,r){var i=t.Map;var u=n instanceof i?n:t.fromJS(n);var a=r||{};return new l(e,t,u,{statePropertyName:a.statePropertyName||"state",requestAnimationFrameEnabled:a.requestAnimationFrameEnabled||false})}}},{"./Binding":1,"./DOM":2,"./History":3,"./Util":5,"./util/Callback":6}],5:[function(e,t,n){var r,i,u;r=function(e){return typeof e==="string"&&e.charAt(0)!=="?"};i=function(e,t){var n=t(e[0]);for(var r=1;r<e.length;r++){if(t(e[r])!==n)return r}return null};u=function(e,t){return e.slice(t).reverse().concat(e.slice(0,t))};t.exports={identity:function(e){return e},not:function(e){return!e},constantly:function(e){return function(){return e}},afterComplete:function(e,t){var n=e();if(n&&typeof n.always==="function"){n.always(t)}else{t()}},undefinedOrNull:function(e){return e===undefined||e===null},startsWith:function(e,t){return e.indexOf(t)===0},toString:function(e){switch(e){case undefined:return"undefined";case null:return"null";default:if(typeof e==="string"){return'"'+e+'"'}else if(Array.isArray(e)){return"["+e.join(", ")+"]"}else{return e.toString()}}},equals:function(e,t){return e===t||e&&e.equals&&e.equals(t)},getPropertyValues:function(e){return Object.keys(e).map(function(t){return e[t]})},find:function(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(t(r,n,e)){return r}}return null},resolveArgs:function(e,t){var n={};if(arguments.length>1){var a=Array.isArray(t)?t:Array.prototype.slice.call(arguments,1);var s,o;var l;if(r(a[0])||!(l=i(a,r))){s=a;o=e}else{var f=Array.isArray(e)?e:Array.prototype.slice.call(e);s=u(a,l);o=u(f,f.length-(a.length-l))}for(var c=0,p=0;c<s.length&&p<o.length;c++){var v=s[c],h=o[p];if(r(v)){n[v]=h;p++}else{var d=typeof v==="function"?v(h):v.charAt(0)!=="?"?v:v.substring(1);if(d||h===undefined){n[d]=h;p++}}}}return n},canRepresentSubpath:function(e){var t=typeof e;return t==="string"||t==="number"||Array.isArray(e)},shallowMerge:function(e,t){for(var n in e){if(e.hasOwnProperty(n)){t[n]=e[n]}}return t},papply:function(e,t,n){var r=this;var i=function(t,n){var u=arguments.length>1?Array.prototype.slice.call(arguments,1):null;if(t){var a={};if(i._props){r.shallowMerge(i._props,a);r.shallowMerge(t,a)}else{a=t}return e(a,u)}else{return e(i._props,u)}};if(e._props){var u={};if(n!==false){r.shallowMerge(e._props,u);r.shallowMerge(t,u)}else{r.shallowMerge(t,u);r.shallowMerge(e._props,u)}i._props=u}else{i._props=t}return i}}},{}],6:[function(e,t,n){var r=e("../Util");t.exports={set:function(e,t,n){var i=r.resolveArgs(arguments,"binding",function(e){return r.canRepresentSubpath(e)?"subpath":null},"?f");return function(t){var n=t.target.value;e.set(i.subpath,i.f?i.f(n):n);return false}},"delete":function(e,t,n){var i=r.resolveArgs(arguments,"binding",function(e){return r.canRepresentSubpath(e)?"subpath":null},"?pred");return function(t){var n=t.target.value;if(!i.pred||i.pred(n)){e.delete(i.subpath)}return false}},onKey:function(e,t,n,i){var u=n||false;var a=i||false;return function(n){var i=typeof t==="string"?n.key===t:r.find(t,function(e){return e===n.key});if(i&&n.shiftKey===u&&n.ctrlKey===a){e(n);return false}else{return true}}},onEnter:function(e){return this.onKey(e,"Enter")},onEscape:function(e){return this.onKey(e,"Escape")}}},{"../Util":5}],7:[function(e,t,n){var r=function(e){this._value=e};r.prototype=Object.freeze({init:function(e){return new r(e)},getValue:function(){return this._value},setValue:function(e){this._value=e},updateValue:function(e){var t=this._value;this._value=e(t);return t}});t.exports=new r(null)},{}]},{},[4])(4)});